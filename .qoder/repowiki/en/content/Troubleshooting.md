# Troubleshooting

<cite>
**Referenced Files in This Document**   
- [config.yaml](file://pyama-qt/src/pyama_qt/config.yaml)
- [main.py](file://pyama-qt/src/pyama_qt/main.py)
- [processing/controller.py](file://pyama-qt/src/pyama_qt/processing/controller.py)
- [analysis/controller.py](file://pyama-qt/src/pyama_qt/analysis/controller.py)
- [visualization/controller.py](file://pyama-qt/src/pyama_qt/visualization/controller.py)
- [processing/panels/workflow_panel.py](file://pyama-qt/src/pyama_qt/processing/panels/workflow_panel.py)
- [analysis/panels/data_panel.py](file://pyama-qt/src/pyama_qt/analysis/panels/data_panel.py)
- [analysis/panels/fitting_panel.py](file://pyama-qt/src/pyama_qt/analysis/panels/fitting_panel.py)
- [analysis/panels/results_panel.py](file://pyama-qt/src/pyama_qt/analysis/panels/results_panel.py)
- [visualization/panels/project_panel.py](file://pyama-qt/src/pyama_qt/visualization/panels/project_panel.py)
- [visualization/panels/image_panel.py](file://pyama-qt/src/pyama_qt/visualization/panels/image_panel.py)
- [visualization/panels/trace_panel.py](file://pyama-qt/src/pyama_qt/visualization/panels/trace_panel.py)
</cite>

## Table of Contents
1. [File Format Errors](#file-format-errors)
2. [Memory Issues](#memory-issues)
3. [Fitting Failures](#fitting-failures)
4. [UI Glitches](#ui-glitches)
5. [Diagnostic Techniques](#diagnostic-techniques)
6. [Known Limitations and Workarounds](#known-limitations-and-workarounds)
7. [Testing Infrastructure](#testing-infrastructure)
8. [Bug Reporting Guidelines](#bug-reporting-guidelines)

## File Format Errors

### ND2 File Loading Issues
**Symptoms**: Unable to load microscopy files, error messages about file format, or metadata not being displayed in the Processing tab.

**Root Cause**: The application supports ND2 and CZI microscopy formats, but may encounter issues with corrupted files, unsupported versions, or incorrect file paths.

**Resolution**:
1. Verify the file extension is .nd2 or .czi
2. Check that the file is not corrupted by opening it in Nikon Elements or other compatible software
3. Ensure the file path does not contain special characters or spaces
4. Confirm the file is not open in another application

**Section sources**
- [processing/controller.py](file://pyama-qt/src/pyama_qt/processing/controller.py#L333-L603)
- [processing/panels/workflow_panel.py](file://pyama-qt/src/pyama_qt/processing/panels/workflow_panel.py#L32-L328)

### CSV Data Loading Problems
**Symptoms**: Analysis tab fails to load CSV files, or loaded data appears incomplete or malformed.

**Root Cause**: The analysis module expects specific CSV formats generated by the processing pipeline, with time as the index and cell traces as columns.

**Resolution**:
1. Ensure the CSV file was generated by PyAMA's processing workflow
2. Verify the file has a header row with cell identifiers
3. Check that the first column contains time values
4. Confirm the file encoding is UTF-8

**Section sources**
- [analysis/controller.py](file://pyama-qt/src/pyama_qt/analysis/controller.py#L21-L135)
- [analysis/panels/data_panel.py](file://pyama-qt/src/pyama_qt/analysis/panels/data_panel.py#L23-L102)

## Memory Issues

### High Memory Consumption During Processing
**Symptoms**: Application becomes unresponsive, system memory usage spikes, or processing workflow fails with memory-related errors.

**Root Cause**: Processing large microscopy datasets requires significant memory, especially when handling multiple FOVs and channels simultaneously.

**Resolution**:
1. Reduce the batch size in the Processing tab (default is 2)
2. Decrease the number of worker processes in the Processing tab (default is 2)
3. Process fewer FOVs at a time by setting explicit start/end values
4. Close other memory-intensive applications during processing

**Section sources**
- [processing/controller.py](file://pyama-qt/src/pyama_qt/processing/controller.py#L333-L603)
- [processing/models.py](file://pyama-qt/src/pyama_qt/processing/models.py#L31-L188)

### Memory Leaks in Visualization
**Symptoms**: Memory usage increases continuously when navigating between FOVs or changing visualization parameters.

**Root Cause**: Image data may not be properly cleared from memory when switching between views.

**Resolution**:
1. Restart the application if memory usage becomes excessive
2. Process smaller datasets when possible
3. Avoid rapid navigation between many FOVs in succession
4. Close unused visualization tabs

**Section sources**
- [visualization/controller.py](file://pyama-qt/src/pyama_qt/visualization/controller.py#L32-L266)
- [visualization/panels/image_panel.py](file://pyama-qt/src/pyama_qt/visualization/panels/image_panel.py#L27-L306)

## Fitting Failures

### Model Fitting Errors
**Symptoms**: Fitting process fails to complete, error messages about fitting algorithms, or no fitted results appear in the results panel.

**Root Cause**: The fitting process may fail due to poor quality data, inappropriate model parameters, or numerical instability in the fitting algorithm.

**Resolution**:
1. Ensure CSV data has been successfully loaded before starting fitting
2. Verify that the data contains sufficient time points for the selected model
3. Adjust model parameters to reasonable ranges based on expected biological behavior
4. Try the "Trivial" model first to verify the fitting pipeline works

**Section sources**
- [analysis/controller.py](file://pyama-qt/src/pyama_qt/analysis/controller.py#L21-L135)
- [analysis/panels/fitting_panel.py](file://pyama-qt/src/pyama_qt/analysis/panels/fitting_panel.py#L32-L306)

### Missing Fitted Results
**Symptoms**: Fitting completes successfully but no results appear in the results panel or QC plots.

**Root Cause**: The application looks for a corresponding _fitted.csv file in the same directory as the original CSV.

**Resolution**:
1. Check that the output directory has write permissions
2. Verify disk space is available
3. Ensure the original CSV file path does not contain special characters
4. Manually check if the _fitted.csv file was created in the expected location

**Section sources**
- [analysis/controller.py](file://pyama-qt/src/pyama_qt/analysis/controller.py#L21-L135)
- [analysis/panels/results_panel.py](file://pyama-qt/src/pyama_qt/analysis/panels/results_panel.py#L26-L263)

## UI Glitches

### Unresponsive Interface
**Symptoms**: Buttons don't respond to clicks, tabs don't switch, or the application appears frozen.

**Root Cause**: Long-running operations may block the UI thread, or there may be issues with event handling.

**Resolution**:
1. Wait for current operations to complete (check status bar for progress)
2. If unresponsive for more than a few minutes, restart the application
3. Ensure you are using the latest version of PyAMA-Qt
4. Check system requirements are met (RAM, CPU, graphics)

**Section sources**
- [main.py](file://pyama-qt/src/pyama_qt/main.py#L0-L73)
- [processing/controller.py](file://pyama-qt/src/pyama_qt/processing/controller.py#L333-L603)

### Incorrect Channel Display
**Symptoms**: Wrong channels appear in dropdowns, channel names are missing, or fluorescence channels are not selectable.

**Root Cause**: Channel information is extracted from the microscopy file metadata, which may be incomplete or improperly formatted.

**Resolution**:
1. Verify the microscopy file contains channel information
2. Check that channel names in the file are not empty or identical
3. Restart the application after loading a new microscopy file
4. If using ND2 files, ensure they were saved with metadata intact

**Section sources**
- [processing/panels/workflow_panel.py](file://pyama-qt/src/pyama_qt/processing/panels/workflow_panel.py#L32-L328)
- [processing/controller.py](file://pyama-qt/src/pyama_qt/processing/controller.py#L333-L603)

## Diagnostic Techniques

### Log File Analysis
The application generates log messages that can help diagnose issues. Key log locations include:

- **Processing errors**: Look for "Failed to load ND2" or "Cannot start workflow" messages
- **Fitting errors**: Check for "Analysis worker error" or "Error fitting cell" entries
- **Visualization errors**: Search for "Error loading project" or "Error loading FOV data"

**Section sources**
- [processing/controller.py](file://pyama-qt/src/pyama_qt/processing/controller.py#L333-L603)
- [analysis/controller.py](file://pyama-qt/src/pyama_qt/analysis/controller.py#L21-L135)
- [visualization/controller.py](file://pyama-qt/src/pyama_qt/visualization/controller.py#L32-L266)

### Configuration Validation
Verify the application configuration is correct:

1. Check that DEFAULT_DIR in config.yaml points to a valid directory
2. Ensure the configuration file is in the correct location
3. Verify file permissions allow reading the configuration

**Section sources**
- [config.yaml](file://pyama-qt/src/pyama_qt/config.yaml#L0-L6)

## Known Limitations and Workarounds

### Microscopy Format Support
**Limitation**: Only ND2 and CZI formats are supported for microscopy files.

**Workaround**: Convert other microscopy formats to ND2 using Nikon Elements or similar software before processing.

### Large Dataset Processing
**Limitation**: Very large datasets may exceed memory capacity or take excessive processing time.

**Workaround**: Process datasets in smaller batches by setting explicit FOV ranges in the Processing tab.

### Parameter Persistence
**Limitation**: Processing and analysis parameters are not automatically saved between sessions.

**Workaround**: Note down important parameter settings for reproducibility, or modify the default values in the parameter panels.

**Section sources**
- [processing/panels/workflow_panel.py](file://pyama-qt/src/pyama_qt/processing/panels/workflow_panel.py#L32-L328)
- [analysis/panels/fitting_panel.py](file://pyama-qt/src/pyama_qt/analysis/panels/fitting_panel.py#L32-L306)

## Testing Infrastructure

### Test Datasets
The repository includes test datasets and scripts to verify installation:

- **test_nd2.py**: Tests ND2 file loading functionality
- **test_workflow.py**: Validates the complete processing workflow
- **test_algo.ipynb**: Jupyter notebook for testing analysis algorithms
- **test_bioio.py**: Tests bio-format IO operations

To verify your installation:
1. Run the test scripts in the tests directory
2. Ensure all tests pass without errors
3. Check that test datasets can be processed completely

**Section sources**
- [main.py](file://pyama-qt/src/pyama_qt/main.py#L0-L73)
- [processing/controller.py](file://pyama-qt/src/pyama_qt/processing/controller.py#L333-L603)

## Bug Reporting Guidelines

When reporting bugs, include the following information:

1. **Application version**: Check the version in the application or repository
2. **Operating system**: Windows, macOS, or Linux with version details
3. **Python environment**: Python version and package versions
4. **Steps to reproduce**: Detailed steps that lead to the issue
5. **Expected behavior**: What you expected to happen
6. **Actual behavior**: What actually happened
7. **Error messages**: Complete error messages from logs or UI
8. **Sample data**: If possible, provide a small dataset that reproduces the issue

Submit bug reports through the project's issue tracker with the "bug" label.

**Section sources**
- [main.py](file://pyama-qt/src/pyama_qt/main.py#L0-L73)
- [processing/controller.py](file://pyama-qt/src/pyama_qt/processing/controller.py#L333-L603)
- [analysis/controller.py](file://pyama-qt/src/pyama_qt/analysis/controller.py#L21-L135)